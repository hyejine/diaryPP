<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.example.demo.model.dao.BoardMapper">
  
    <resultMap type="DiaryDto" id="diaryJoin">
      <result property="diary_id" column="diary_id"/>
      <result property="diary_create_write" column="diary_create_write"/>
      <result property="diary_date" column="diary_date"/>
      <result property="user_email" column="user_email"/>
      <result property="diary_title" column="diary_title"/>
      <result property="diary_content" column="diary_content"/>
      <result property="emoji_image_id" column="emoji_image_id"/>
      <collection property="emojiImageDto" resultMap="emojiImageJoin"/>
    </resultMap>
    
    <resultMap type="EmojiImageDto" id="emojiImageJoin">
		  <result column="id" property="id" />
		  <result column="emoji_type" property="emoji_type" />
		  <result column="emoji_image" property="emoji_image" />
	  </resultMap>

  <insert id="saveQuill"  parameterType="DiaryDto" useGeneratedKeys="true" keyProperty="diary_id">
    INSERT 
    INTO diary_table(diary_title, user_email, diary_content, diary_date, emoji_image_id, diary_create_write) 
    VALUES (#{diary_title}, #{user_email}, #{diary_content}, #{diary_date}, #{emoji_image_id}, NOW())
  </insert>

  <select id="getBoard" resultMap="diaryJoin" parameterType="DiaryDto">
	  SELECT e.id, e.emoji_type, e.emoji_image, 
    d.diary_id, d.diary_create_write, d.diary_date, d.user_email, d.diary_title, d.diary_content, d.emoji_image_id 
    FROM diary_table d, emoji_image_table e WHERE d.emoji_image_id = e.id 
    <if test="diary_id != -1">
      AND diary_id=#{diary_id}
    </if>
  </select> 

  <!-- 월별 조회되도록 -->
  <select id="getMonthBoard" resultMap="diaryJoin" parameterType="DiaryDto">
	  SELECT e.id, e.emoji_type, e.emoji_image, 
    d.diary_id, d.diary_create_write, d.diary_date, d.user_email, d.diary_title, d.diary_content, d.emoji_image_id 
    FROM diary_table d, emoji_image_table e WHERE d.emoji_image_id = e.id order by diary_date
    <!-- AND  DATE_FORMAT(diary_date,'%Y-%m') = DATE_FORMAT(now(),'2022-09') -->
  </select> 

  <delete id="deleteBoard" parameterType="DiaryDto">
    DELETE FROM diary_table WHERE diary_id = #{diary_id};
  </delete>


</mapper>